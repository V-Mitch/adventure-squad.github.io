<!-- _includes/photo-gallery.html -->
<div class="photo-gallery" id="gallery-{{ include.gallery_id | default: 'default' }}">
  {% for image in include.images %}
    <div class="gallery-item" onclick="openModal('{{ image.src }}', '{{ image.alt | escape }}', '{{ image.caption | escape }}')">
      <img src="{{ image.src }}" alt="{{ image.alt }}" loading="lazy">
      {% if image.caption %}
        <div class="caption">{{ image.caption }}</div>
      {% endif %}
    </div>
  {% endfor %}
</div>

<!-- Modal for expanded view -->
<div id="imageModal" class="modal" onclick="closeModal()">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modalImg">
  <div id="modalCaption" class="modal-caption"></div>
  <div class="modal-nav">
    <button id="prevBtn" onclick="changeImage(-1)">&#10094;</button>
    <button id="nextBtn" onclick="changeImage(1)">&#10095;</button>
  </div>
</div>

<script>
// Gallery functionality
let currentImages = [];
let currentIndex = 0;

function openModal(src, alt, caption) {
  // Get all images from the current gallery
  const gallery = event.target.closest('.photo-gallery');
  const images = gallery.querySelectorAll('img');
  
  currentImages = Array.from(images).map(img => ({
    src: img.src,
    alt: img.alt,
    caption: img.parentElement.querySelector('.caption')?.textContent || ''
  }));
  
  // Find current image index
  currentIndex = currentImages.findIndex(img => img.src === src);
  
  // Show modal
  const modal = document.getElementById('imageModal');
  const modalImg = document.getElementById('modalImg');
  const modalCaption = document.getElementById('modalCaption');
  
  modal.style.display = 'block';
  modalImg.src = src;
  modalImg.alt = alt;
  modalCaption.textContent = caption;
  
  // Prevent body scrolling
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('imageModal').style.display = 'none';
  document.body.style.overflow = 'auto';
}

function changeImage(direction) {
  currentIndex += direction;
  
  if (currentIndex >= currentImages.length) {
    currentIndex = 0;
  } else if (currentIndex < 0) {
    currentIndex = currentImages.length - 1;
  }
  
  const modalImg = document.getElementById('modalImg');
  const modalCaption = document.getElementById('modalCaption');
  const currentImg = currentImages[currentIndex];
  
  modalImg.src = currentImg.src;
  modalImg.alt = currentImg.alt;
  modalCaption.textContent = currentImg.caption;
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
  const modal = document.getElementById('imageModal');
  if (modal.style.display === 'block') {
    if (e.key === 'Escape') {
      closeModal();
    } else if (e.key === 'ArrowLeft') {
      changeImage(-1);
    } else if (e.key === 'ArrowRight') {
      changeImage(1);
    }
  }
});

// Prevent modal from closing when clicking on image
document.getElementById('modalImg')?.addEventListener('click', function(e) {
  e.stopPropagation();
});
</script>